# アプリケーション設計書: SDD Sale Price Logger

## 1. 概要
**SDD Sale Price Logger** は、ユーザーが様々な店舗の商品価格を記録・比較するためのモバイルアプリケーションです。価格を時系列で記録することで、特定の商品が最も安い店舗を特定したり、価格の推移を可視化したりすることができます。

## 2. 技術スタック
*   **フレームワーク**: Flutter (Dart)
*   **プラットフォーム**: iOS / Android
*   **データベース**: SQLite (Drift パッケージを使用)
*   **状態管理**: Riverpod
*   **チャート表示**: fl_chart
*   **多言語対応**: 対応済み (英語 / 日本語)

## 3. データモデル

### 3.1 Products (`products` テーブル)
| フィールド名 | 型 | 説明 |
|---|---|---|
| `id` | Integer (PK) | 一意の識別子 |
| `name` | Text | 商品名 |
| `categoryId` | Integer (FK) | `categories.id` への参照 |
| `imagePath` | Text (Nullable) | 商品画像のローカルファイルパス |
| `emoji` | Text (Nullable) | 商品のアイコン用絵文字 |
| `createdAt` | DateTime | レコード作成日時 |

### 3.2 Shops (`shops` テーブル)
| フィールド名 | 型 | 説明 |
|---|---|---|
| `id` | Integer (PK) | 一意の識別子 |
| `name` | Text | 店舗名 |

### 3.3 Categories (`categories` テーブル)
| フィールド名 | 型 | 説明 |
|---|---|---|
| `id` | Integer (PK) | 一意の識別子 |
| `name` | Text | カテゴリ名 (例: "食品", "家電") |
| `taxRate` | Real | デフォルト税率 (例: 10.0), 初期値 10.0 |

### 3.4 Prices (`prices` テーブル)
| フィールド名 | 型 | 説明 |
|---|---|---|
| `id` | Integer (PK) | 一意の識別子 |
| `productId` | Integer (FK) | `products.id` への参照 |
| `shopId` | Integer (FK) | `shops.id` への参照 |
| `price` | Integer | 価格 |
| `isTaxIncluded` | Boolean | 税込価格かどうか (初期値: true) |
| `date` | DateTime | 価格記録日 |
| `createdAt` | DateTime | レコード作成日時 |

## 4. 機能一覧

### 4.1 商品管理 (Product Management)
*   **リスト表示**: 商品をカテゴリ別、または名前順で表示。
    *   カテゴリによる**フィルタリング**機能。
    *   名前による**ソート**機能（昇順/降順）。
    *   商品名による**検索**機能。
*   **追加/編集**: 
    *   商品名、カテゴリ、画像（カメラ/ギャラリー）、絵文字の入力。
    *   商品追加画面から新しいカテゴリを直接作成可能。
*   **削除**: 商品の削除。
    *   **カスケード警告**: 商品を削除する際、関連する価格履歴も削除される旨の警告を表示。

### 4.2 価格記録 (Price Logging)
*   **エントリ追加**: 特定の店舗での商品の価格を記録。
    *   入力項目: 商品（詳細画面からの遷移時は自動選択）、店舗、価格、税込/税抜切り替え、日付。
    *   記録画面から新しい店舗を直接作成可能。
*   **編集/削除**: 価格履歴リストを長押しすることで、履歴の修正や削除が可能。

### 4.3 商品詳細 (Product Detail)
*   **チャート**: 週、月、年、全期間での価格推移をグラフ化。
*   **履歴リスト**: 商品の全価格履歴を時系列で表示。
    *   価格、店舗名、日付を表示。

### 4.4 マスタデータ管理 (Settings)
*   **店舗 (Shops)**: 店舗の一覧表示、追加、編集、削除。
*   **カテゴリ (Categories)**: カテゴリの一覧表示、追加、編集、削除。
    *   カテゴリごとのデフォルト税率設定。
*   **カスケード削除**: 店舗やカテゴリを削除する際、それに紐づく商品や価格データがある場合は警告を表示。

### 4.5 多言語対応 (Localization)
*   **対応言語**: 英語 (en) / 日本語 (ja)。
*   **実装**: `flutter_localizations` と `.arb` ファイルを使用。

## 5. UI/UX デザイン
*   **テーマ**: Material 3 デザイン (シードカラー: Deep Purple)。
*   **ナビゲーション**:
    *   **ホーム**: 商品リスト、エントリ追加用フローティングアクションボタン (FAB)。
    *   **詳細**: 商品ごとの詳細情報と履歴。
    *   **設定**: 店舗とカテゴリの管理。
*   **アイコン**: カスタムアプリアイコン (`flutter_launcher_icons` で生成)。

## 6. 実装リファレンス
*   **アーキテクチャ**: Riverpod プロバイダーを使用したリポジトリパターン。
*   **ローカルストレージ**: 画像保存に `path_provider` を使用。
